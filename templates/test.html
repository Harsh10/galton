$def with (id, form)

<html>

<head>
<link rel="stylesheet" type="text/css" href="/static/muffin.css" /> 
<script type="text/javascript" src="/static/mootools.js"/>
<script type="text/javascript" src="/static/sprintf.js"/>
<script type="text/javascript" src="/static/jscharts.js"/>
<script type="text/javascript">    
    function setContent(id, val)
    {
        document.getElementById(id).innerHTML = val;
    }
    
    function addContent(id, val)
    {
        document.getElementById(id).innerHTML += val;
    }
    
    function getContent(id)
    {
        return document.getElementById(id).value;
    }
    
    function showResults(results)
    {
        setContent('result', sprintf("montecarlo simulation took %3.2fs for %d iterations", results.simtime, results.trials));
        setContent('mean', sprintf("%.2f", results.mean));
        setContent('p10', sprintf("%.2f", results.cumprob[10][0]));
        setContent('p50', sprintf("%.2f", results.cumprob[50][0]));
        setContent('p90', sprintf("%.2f", results.cumprob[90][0]));  
        setContent('risk', sprintf("%.2f", results.risk));  
        
        drawChart(results.cumprob);
        document.getElementById('run').disabled = false;
    }
    
    function runSim()
    {     
        document.getElementById('run').disabled = true;
        var resultsURL = "/project/$id/results?trials=" + getContent('trials');
        var jsonRequest = new Request.JSON({method: 'get', url: resultsURL, onSuccess: showResults});
        jsonRequest.get();
    }
    
    function drawChart(myData)
    {
        var myChart = new JSChart('graph', 'line');
        myChart.setDataArray(myData);
        myChart.setLineColor('#8D9386');
        myChart.setLineWidth(4);
        myChart.setTitleColor('#7D7D7D');
        myChart.setAxisColor('#9F0505');
        myChart.setGridColor('#a4a4a4');
        myChart.setAxisValuesColor('#333639');
        myChart.setAxisNameColor('#333639');
        myChart.setTextPaddingLeft(0);
        myChart.setAxisNameX("effort");
        myChart.setAxisNameY("confidence");
        myChart.setTitle("project");
        myChart.draw();
    }
</script>
</head>

<body>
$:form.render()
<p>

<form>
iterations: <input type="text" id='trials' value="10000" />
<input type="button" value="Run Simulation" id='run' onclick="runSim()" />
</form>

<table border="1">
    <tr> <th width="50">mean</th> <td width="50"><div id="mean" /></td> </tr>
    <tr> <th>p10</th> <td><div id="p10" /></td> </tr>
    <tr> <th>p50</th> <td><div id="p50" /></td> </tr>
    <tr> <th>p90</th> <td><div id="p90" /></td> </tr>
    <tr> <th>risk</th> <td><div id="risk" /></td> </tr>
</table>

<div id="graph"></div>
<div id="result"></div>
</body>
</html>
